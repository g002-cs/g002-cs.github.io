<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>通識課程輸入</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background-color: #fff; }

  /* 導覽列 */
  .navbar { background-color: #98B1E0; display: flex; align-items: center; padding: 10px 20px; }
  .navbar img { width: 40px; height: 40px; margin-right: 20px; }
  .navbar a { text-decoration: none; color: black; margin-right: 100px; font-weight: bold; }
  .navbar a:hover { text-decoration: underline; }

  .left-arrow { display: inline-block; background-color: #98B1E0; padding: 15px 25px;
    clip-path: polygon(0 50%, 20% 0, 100% 0, 100% 100%, 20% 100%);
    font-size: 18px; color: black; margin: 20px 0 20px 40px; }

  .content { margin: 20px 40px; }
  .filters { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
  select { padding: 10px 15px; background-color: #98B1E0; border: none; border-radius: 5px; font-size: 16px; }
  
  #typeSelect {
    padding: 10px 15px;
    background-color: #98B1E0;
    color: black;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }

  /* 主區塊 */
  .main-area { display: flex; justify-content: space-between; gap: 30px; }
  .course-list { width: 50%; background-color: #f5f5f5; padding: 20px; border-radius: 8px; }
  .course-list h3 { margin-bottom: 10px; }

  .input-area { display: flex; flex-direction: column; gap: 15px; }
  label { font-size: 16px; }
  input, select { padding: 10px; font-size: 16px; border: none; background-color: #ddd; border-radius: 5px; }
  button { background-color: #98B1E0; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; }
  button:hover { background-color: #7EA5D6; }

  /* 刪除按鈕 */
  .course-list ol li { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; }
  .course-list ol li button { background-color: #ff4d4d; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; margin-left: 10px; }
  .course-list ol li button:hover { background-color: #e60000; }
</style>
</head>
<body>

<!-- 導覽列 -->
<div class="navbar">
  <a id="homeLink" href="#"><img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="Home"></a>
  <a id="introLink" href="#">系統介紹</a>
  <a id="requiredLink" href="#">必修科目表</a>
  <a id="courseLink" href="#">課程輸入</a>
  <a id="creditsLink" href="#">學分計算</a>
</div>

<div class="left-arrow">通識課程輸入</div>

<div class="content">
  學號：<span id="studentIdDisplay"></span>

  <div class="filters">
    <label for="typeSelect">單/選/通：</label>
    <select id="typeSelect">
      <option value="必修">必修</option>
      <option value="選修">選修</option>
      <option value="通識" selected>通識</option>
    </select>
  </div>

  <div class="main-area">
    <!-- 左側顯示已輸入課程 -->
    <div class="course-list">
      <h3>（已輸入課程顯示區）</h3>
      <ol id="generalCourseList"></ol>
    </div>

    <!-- 右側輸入區 -->
    <div class="input-area">
      <label>科目名稱：<input type="text" id="courseName" placeholder="自行輸入"></label>
      <label>學分：<input type="number" id="courseCredits" placeholder="自行輸入"></label>
      <label>分類：
        <select id="courseCategorySelect">
          <option value="人文" selected>人文</option>
          <option value="社會">社會</option>
          <option value="自然">自然</option>
          <option value="其他">其他</option>
        </select>
      </label>
      <button id="addCourseBtn">確定</button>
    </div>
  </div>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const studentId = params.get('studentId');
  const group = params.get('group');
  const year = params.get('year');
  const allowedGroups = ['行銷與數位經營組','服務創新與創業組','尚未分組'];
  if (!studentId || !allowedGroups.includes(group)) window.location.href = 'login.html';

  function withParams(page) {
    return `${page}?studentId=${encodeURIComponent(studentId)}&group=${encodeURIComponent(group)}&year=${encodeURIComponent(year)}`;
  }

  document.getElementById('homeLink').href = withParams('login.html');
  document.getElementById('introLink').href = withParams('page2.html');
  document.getElementById('requiredLink').href = withParams('required.html');
  document.getElementById('courseLink').href = withParams('course.html');
  document.getElementById('creditsLink').href = withParams('credits.html');
  document.getElementById('studentIdDisplay').textContent = studentId;

  // 元件
  const courseList = document.getElementById('generalCourseList');
  const courseName = document.getElementById('courseName');
  const courseCredits = document.getElementById('courseCredits');
  const courseCategorySelect = document.getElementById('courseCategorySelect');

  const generalKey = `general_courses_${studentId}`;

  // 新增課程
  document.getElementById('addCourseBtn').onclick = () => {
    const n = courseName.value.trim();
    const c = courseCredits.value.trim();
    const cat = courseCategorySelect.value;
    if (!n || !c) return alert('請輸入完整資訊');
    const li = document.createElement('li');
    li.textContent = `[${cat}] ${n}　${c}學分`;
    const del = document.createElement('button');
    del.textContent = '刪除';
    del.onclick = () => { li.remove(); saveCourses(); };
    li.appendChild(del);
    courseList.appendChild(li);
    courseName.value = ''; courseCredits.value = ''; courseCategorySelect.value = '人文';
    saveCourses();
  };

  // 儲存課程
  function saveCourses() {
    const data = [];
    courseList.querySelectorAll('li').forEach(li => {
      const match = li.textContent.replace('刪除','').trim().match(/\[(.+)\]\s(.+)\s+(\d+)學分/);
      if(match) data.push({ category: match[1], name: match[2], credits: Number(match[3]) });
    });
    localStorage.setItem(generalKey, JSON.stringify(data));
  }

  // 載入課程
  function loadCourses() {
    const data = JSON.parse(localStorage.getItem(generalKey) || '[]');
    data.forEach(c => {
      const li = document.createElement('li');
      li.textContent = `[${c.category}] ${c.name}　${c.credits}學分`;
      const del = document.createElement('button');
      del.textContent = '刪除';
      del.onclick = () => { li.remove(); saveCourses(); };
      li.appendChild(del);
      courseList.appendChild(li);
    });
  }
  loadCourses();

  // 單/選/通切換
  document.getElementById('typeSelect').addEventListener('change', e => {
    const v = e.target.value;
    if (v === '必修') window.location.href = withParams('required-course.html');
    if (v === '選修') window.location.href = withParams('elective-course.html');
    if (v === '通識') window.location.href = withParams('general-course.html');
  });
</script>

</body>
</html>
