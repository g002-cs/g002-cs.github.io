<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å­¸åˆ†è¨ˆç®—</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background-color: #fff; }
.navbar {
  background-color: #98B1E0;
  display: flex;
  align-items: stretch; /* ğŸ”¸é‡é»ï¼šè®“æ¯å€‹ a æ’æ»¿æ•´å€‹å°è¦½åˆ—é«˜åº¦ */
  padding: 0;           /* ç§»é™¤ä¸Šä¸‹é‚Šè· */
  height: 60px;         /* å›ºå®šé«˜åº¦ï¼Œå¯è‡ªè¡Œèª¿æ•´ */
}

.navbar img {
  width: 40px;
  height: 40px;
  margin-right: 20px;
  vertical-align: middle;
}

/* ğŸ”¹ å°è¦½åˆ—é€£çµçµ±ä¸€è¨­å®š */
.navbar a {
  display: flex;
  align-items: center;        /* å‚ç›´ç½®ä¸­ */
  justify-content: center;    /* æ°´å¹³ç½®ä¸­ */
  text-decoration: none;
  color: black;
  font-weight: bold;
  font-size: 16px;
  padding: 0 35px;            /* ğŸ”¸é€™è£¡æ§åˆ¶æ¬„å¯¬ï¼Œæ¯”æ–‡å­—ç•¥å¯¬ */
  height: 100%;               /* æ’æ»¿å°è¦½åˆ—ä¸Šä¸‹ */
  transition: background-color 0.3s;
}

.navbar a:nth-of-type(1) {
  padding: 0 10px;          /* æ¯”å…¶ä»–é …ç›®çª„ä¸€é» */
}

/* ğŸ”¹ æ»‘éæ™‚é¡è‰² */
.navbar a:hover {
  background-color: #A4BFF2;
}

/* ğŸ”¹ ç•¶å‰é é¢æ•´å¡Šè®Šè‰²ï¼ˆä¸Šä¸‹è²¼é½Šï¼‰*/
.navbar a.active {
  background-color: #1284EB;
  color: white;
}

  .left-arrow {
    display: inline-block; background-color: #98B1E0; padding: 15px 25px;
    clip-path: polygon(0 50%, 20% 0, 100% 0, 100% 100%, 20% 100%);
    font-size: 18px; color: black; margin: 20px 0 20px 40px;
  }

  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th { border-bottom: 1px solid #ccc; padding: 15px; text-align: center; font-size: 18px; background-color:#1284EB; color:white; }
  td { border-bottom: 1px solid #ccc; padding: 15px; text-align: center; font-size: 16px; }
  button {
    background-color: #98B1E0; border: none; padding: 6px 12px; font-size: 15px; border-radius: 6px; cursor: pointer;
  }
  button:hover { background-color: #7DA6D1; }
</style>
</head>
<body>

<script>
  const params = new URLSearchParams(window.location.search);
  const studentId = params.get('studentId');
  const group = params.get('group');
  const year = params.get('year');

  const allowedGroups = ['è¡ŒéŠ·èˆ‡æ•¸ä½ç¶“ç‡Ÿçµ„','æœå‹™å‰µæ–°èˆ‡å‰µæ¥­çµ„','å°šæœªåˆ†çµ„'];
  if (!studentId || !allowedGroups.includes(group)) {
    window.location.href = 'login.html';
  }

  function withParams(page, extra = "") {
    let url = `${page}?studentId=${encodeURIComponent(studentId)}&group=${encodeURIComponent(group)}&year=${encodeURIComponent(year)}`;
    if (extra) url += extra;
    return url;
  }
</script>

<div class="navbar">
  <a id="homeLink" href="#"><img src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="Home"></a>
  <a id="introLink" href="#">ç³»çµ±ä»‹ç´¹</a>
  <a id="requiredLink" href="#">å¿…ä¿®ç§‘ç›®è¡¨</a>
  <a id="courseLink" href="#">èª²ç¨‹è¼¸å…¥</a>
  <a id="creditsLink" href="#" class="active">å­¸åˆ†è¨ˆç®—</a>
</div>

<div class="left-arrow">å­¸åˆ†è¨ˆç®—</div>

<div class="content" style="margin:20px 40px;">
  <div style="margin-bottom: 20px; font-size:18px;">
    å­¸è™Ÿï¼š<span id="studentIdDisplay" style="font-weight:bold;">SXXXXXXXX</span>
  </div>

  <table>
    <thead> 
      <tr style="color:white;">
        <th>ç§‘ç›®é¡åˆ¥</th>
        <th>æ‡‰ä¿®å­¸åˆ†</th>
        <th>å·²ä¿®å­¸åˆ†</th>
        <th>æœªä¿®å­¸åˆ†</th>
        <th>æª¢è¦–</th>
      </tr>
    </thead>
    <tbody id="creditTableBody">
      <tr style="background-color:#ABC7FC; border: 2px #FFFFFF solid;">
        <td>åŸºç¤èª²ç¨‹</td><td id="req-basic"></td><td id="done-basic"></td><td id="remain-basic"></td>
        <td><button onclick="viewCourse('required-course.html', 'åŸºç¤èª²ç¨‹')">æª¢è¦–</button></td>
      </tr>
      <tr style="background-color:#ABC7FC; border: 2px  #FFFFFF solid;">
        <td>ç³»å¿…ä¿®</td><td id="req-major"></td><td id="done-major"></td><td id="remain-major"></td>
        <td><button onclick="viewCourse('required-course.html', 'ç³»å¿…ä¿®')">æª¢è¦–</button></td>
      </tr>
      <tr style="background-color:#ABC7FC; border: 2px  #FFFFFF solid;">
        <td>çµ„å¿…ä¿®</td><td id="req-group"></td><td id="done-group"></td><td id="remain-group"></td>
        <td><button onclick="viewCourse('required-course.html', 'çµ„å¿…ä¿®')">æª¢è¦–</button></td>
      </tr>
      <tr style="background-color:#ABC7FC; border: 2px  #FFFFFF solid;">
        <td>ç³»å…§é¸ä¿®</td><td id="req-elective"></td><td id="done-elective"></td><td id="remain-elective"></td>
        <td><button onclick="viewCourse('elective-course.html', 'ç³»å…§é¸ä¿®')">æª¢è¦–</button></td>
      </tr>
      <tr style="background-color:#ABC7FC; border: 2px  #FFFFFF solid;">
        <td>ç³»å¤–é¸ä¿®</td><td id="req-outside"></td><td id="done-outside"></td><td id="remain-outside"></td>
        <td><button onclick="viewCourse('elective-course.html', 'ç³»å¤–é¸ä¿®')">æª¢è¦–</button></td>
      </tr>
      <tr style="background-color:#ABC7FC; border: 2px  #FFFFFF solid;">
        <td>é€šè­˜</td><td id="req-general"></td><td id="done-general"></td><td id="remain-general"></td>
        <td><button onclick="viewCourse('general-course.html', '')">æª¢è¦–</button></td>
      </tr>
      <tr style="background-color:#98B1E0; font-weight:bold;">
        <td>ç¸½å­¸åˆ†</td><td id="totalRequired"></td><td id="totalCompleted"></td><td id="totalRemaining"></td>
        <td>-</td>
      </tr>
    </tbody>
  </table>

  <div style="color:red; font-size:14px; margin-top:15px;">
    * å¦‚é‡å•é¡Œï¼Œè«‹è©¢å•åŠ©æ•™/è¨»å†Šçµ„ï¼
  </div>
</div>

<script>
  document.getElementById('homeLink').href = withParams('login.html');
  document.getElementById('introLink').href = withParams('page2.html');
  document.getElementById('requiredLink').href = withParams('required.html');
  document.getElementById('courseLink').href = withParams('course.html');
  document.getElementById('creditsLink').href = withParams('credits.html');

  document.getElementById('studentIdDisplay').textContent = studentId;

  const requiredCredits = {
    åŸºç¤èª²ç¨‹: 18,
    ç³»å¿…ä¿®: 42,
    çµ„å¿…ä¿®: 12,
    ç³»å…§é¸ä¿®: 20,
    ç³»å¤–é¸ä¿®: 10,
    é€šè­˜: 14
  };

  // ğŸ”¹ å–å¾—å¿…ä¿®å­¸åˆ†
  function getRequiredCredits(category) {
    const data = JSON.parse(localStorage.getItem(`required_${studentId}`) || '[]');
    return data.filter(c => c.category === category).reduce((sum,c)=>sum+(Number(c.credits)||0),0);
  }

  function getElectiveCredits(type) {
    const data = JSON.parse(localStorage.getItem(`elective_${type}_${studentId}`) || '[]');
    return data.reduce((sum, c) => sum + (parseInt(c.credits)||0), 0);
  }
  function getSDCredits() {
    const data = JSON.parse(localStorage.getItem(`sd_courses_${studentId}`) || '[]');
    return data.reduce((sum, c) => sum + (parseInt(c.credits)||0), 0);
  }
  function getGeneralCredits() {
    const data = JSON.parse(localStorage.getItem(`general_courses_${studentId}`) || '[]');
    return data.reduce((sum, c) => sum + (parseInt(c.credits)||0), 0);
  }

  function fillRow(name, reqId, doneId, remainId) {
    const req = requiredCredits[name];
    let done = 0;
    if (name==='åŸºç¤èª²ç¨‹' || name==='ç³»å¿…ä¿®' || name==='çµ„å¿…ä¿®') done = getRequiredCredits(name);
    else if (name==='ç³»å…§é¸ä¿®') done = getElectiveCredits("internal")+getSDCredits();
    else if (name==='ç³»å¤–é¸ä¿®') done = getElectiveCredits("external");
    else if (name==='é€šè­˜') done = getGeneralCredits();
    const remain = Math.max(req-done,0);
    document.getElementById(reqId).textContent=req;
    document.getElementById(doneId).textContent=done;
    document.getElementById(remainId).textContent=remain;
    return {req,done,remain};
  }

  let totalReq=0,totalDone=0,totalRemain=0;
  const rows=[
    ["åŸºç¤èª²ç¨‹","req-basic","done-basic","remain-basic"],
    ["ç³»å¿…ä¿®","req-major","done-major","remain-major"],
    ["çµ„å¿…ä¿®","req-group","done-group","remain-group"],
    ["ç³»å…§é¸ä¿®","req-elective","done-elective","remain-elective"],
    ["ç³»å¤–é¸ä¿®","req-outside","done-outside","remain-outside"],
    ["é€šè­˜","req-general","done-general","remain-general"]
  ];

  rows.forEach(r=>{
    const res=fillRow(...r);
    totalReq+=res.req;
    totalDone+=res.done;
    totalRemain+=res.remain;
  });

  document.getElementById("totalRequired").textContent=totalReq;
  document.getElementById("totalCompleted").textContent=totalDone;
  document.getElementById("totalRemaining").textContent=totalRemain;

  function viewCourse(page,type){
    page=withParams(page);
    const sep=page.includes('?')?'&':'?';
    window.location.href=`${page}${sep}tab=${type}`;
  }
</script>

</body>
</html>
